# How Our System Meets Competition Criteria

This document explains how our Karnan system addresses each of the competition criteria for the AI-based solar verification challenge.

## 1. Detection Accuracy

### Where it's reported:
- **API Endpoint**: `GET /api/v1/metrics`
- **Evaluation Script**: `scripts/evaluate.py`
- **Database Table**: `site_verifications` (has_solar, confidence fields)

### Implementation Details:
- Our system computes the F1 score for solar panel detection using scikit-learn
- The evaluation script compares predictions against ground truth data
- Results are aggregated and available through the metrics API endpoint

### Files:
- [scripts/evaluate.py](scripts/evaluate.py) - Core evaluation logic
- [app/services/metrics_service.py](app/services/metrics_service.py) - Metrics computation
- [app/api/v1/endpoints/metrics.py](app/api/v1/endpoints/metrics.py) - Metrics API endpoint

## 2. Quantification Metrics

### Where it's calculated:
- **API Endpoint**: `GET /api/v1/metrics`
- **Evaluation Script**: `scripts/evaluate.py`
- **Database Table**: `site_verifications` (pv_area_sqm_est, capacity_kw_est fields)

### Implementation Details:
- Mean Absolute Error (MAE) for area estimation
- Root Mean Square Error (RMSE) for capacity estimation
- The evaluation script computes these metrics using scikit-learn and numpy

### Files:
- [scripts/evaluate.py](scripts/evaluate.py) - Core evaluation logic
- [app/services/metrics_service.py](app/services/metrics_service.py) - Metrics computation
- [app/api/v1/endpoints/metrics.py](app/api/v1/endpoints/metrics.py) - Metrics API endpoint

## 3. Robustness Per-State

### Where it's reported:
- **API Endpoint**: `GET /api/v1/metrics`
- **Database Table**: `site_verifications` (state field)

### Implementation Details:
- Metrics are broken down by state/region
- The system tracks performance across different geographic areas
- Helps identify areas where the model may need improvement

### Files:
- [scripts/evaluate.py](scripts/evaluate.py) - State-wise evaluation
- [app/services/metrics_service.py](app/services/metrics_service.py) - Per-state metrics computation
- [data/examples/sites.csv](data/examples/sites.csv) - Example data with state information

## 4. Code Quality & Documentation

### Linting & Formatting:
- **Black** for code formatting
- **Ruff** for linting
- **isort** for import sorting

### Documentation:
- Comprehensive docstrings in all functions and classes
- Detailed README with setup and usage instructions
- API documentation automatically generated by FastAPI
- Model card and sample output files

### Files:
- [.github/workflows/ci.yml](.github/workflows/ci.yml) - CI pipeline with linting
- [README.md](README.md) - Main documentation
- [MODEL_CARD.md](MODEL_CARD.md) - Model documentation
- [FRONTEND_INTEGRATION.md](FRONTEND_INTEGRATION.md) - Frontend integration guide

## 5. Reproducibility

### Docker & Docker Compose:
- Fully containerized application with Docker
- Single command deployment with docker-compose
- Consistent environment across development and production

### Demo Script:
- Automated demo script to showcase the full pipeline
- Sample data included for immediate testing
- Clear output locations for verification

### Files:
- [Dockerfile](Dockerfile) - Application container definition
- [docker-compose.yml](docker-compose.yml) - Multi-service orchestration
- [scripts/run_demo.sh](scripts/run_demo.sh) - Demo script
- [data/examples/](data/examples/) - Sample data

## 6. Explainability

### Artifact Generation:
- Overlay images with detection results
- Reason codes for model decisions
- Metadata files with detailed explanations

### Certificate Generation:
- Digital certificates with QR codes linking to verification data
- Detailed information about the verification process

### Files:
- [app/services/certificate_service.py](app/services/certificate_service.py) - Certificate generation
- [app/services/imagery_service.py](app/services/imagery_service.py) - Image overlay generation
- [data/outputs/](data/outputs/) - Location for generated artifacts

## 7. Scalability

### Asynchronous Processing:
- RQ (Redis Queue) for background job processing
- Horizontal scaling of worker processes
- Non-blocking API endpoints

### Database Design:
- PostgreSQL for production workloads
- SQLite option for development
- Proper indexing for performance

### Files:
- [app/workers/worker.py](app/workers/worker.py) - Background worker
- [app/services/job_service.py](app/services/job_service.py) - Job management
- [docker-compose.yml](docker-compose.yml) - Multi-service architecture

## 8. Security

### Authentication:
- JWT-based authentication (stub implementation)
- Role-based access control (citizen, officer, auditor, admin)

### Data Protection:
- Sanitization of uploaded files
- Secure storage of sensitive data
- Audit trails for all actions

### Files:
- [app/api/routes.py](app/api/routes.py) - API routing with auth
- [app/core/config.py](app/core/config.py) - Security configuration
- [app/models/models.py](app/models/models.py) - Database models with security considerations

## 9. Innovation

### Multilingual Support:
- Chatbot with support for multiple Indian languages
- Translation capabilities with fallbacks

### Reward System:
- Solar Trust Points (STP) for verified installations
- Blockchain integration for immutable records
- Leaderboard for community engagement

### Files:
- [app/services/chat_service.py](app/services/chat_service.py) - Multilingual chatbot
- [app/services/reward_service.py](app/services/reward_service.py) - Reward system
- [app/services/blockchain_service.py](app/services/blockchain_service.py) - Blockchain integration

This comprehensive approach ensures that our system not only meets but exceeds the competition criteria while providing a solid foundation for production deployment.